"use strict";(self["webpackChunkvue2_cli5"]=self["webpackChunkvue2_cli5"]||[]).push([[330],{52180:function(s,a,t){s.exports=t.p+"img/2.fd53734f.png"},54765:function(s,a,t){s.exports=t.p+"img/3.72042d23.png"},53506:function(s,a,t){s.exports=t.p+"img/noPermission.9bfeba0f.png"},25330:function(s,a,t){t.r(a),t.d(a,{default:function(){return l}});var r=function(){var s=this,a=s.$createElement;s._self._c;return s._m(0)},n=[function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("section",[r("html",[r("head"),r("body",[r("h2",[s._v("pc 端钉钉（包括浙政钉）环境和正常浏览器环境 打开项目做出了区分")]),r("h3",[s._v("1、钉钉环境不需要右上角的退出登录，正常浏览器保留")]),r("p",[s._v("解决方法：通过 isDdOrZzd 方法判断是否需要隐藏退出登录按钮")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":""}},[s._v("// utils/index.js 文件中 getBrowser 方法 新增专有钉钉和浙政钉钉判断\nexport const getBrowser = () => {\n    return {\n        versions: (() => {\n            const u = window.navigator.userAgent;\n            return {\n                .....\n                dingtalk: u.indexOf('DingTalk') > -1, //是否为钉钉内部\n                taurusapp: u.indexOf('TaurusApp') > -1, //是否为专有钉钉和浙政钉钉\n                .....\n            };\n        })(),\n        language: window.navigator.language.toLowerCase(),\n    };\n};\n\n\n// 判断是否是钉钉或者浙政钉\nexport const isDdOrZzd = () => {\n    return getBrowser().versions.dingtalk || getBrowser().versions.taurusapp;\n};\n")])]),r("h3",[s._v("2、由于浏览器不再有退出登录，token 过期（401）时跳转一个 401 页面")]),r("p",[s._v("在 request.js 文件加入判断")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//code返回401")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" (data."),r("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("code")]),s._v(" === "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("401")]),s._v(") {\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("const")]),s._v(" userStore = "),r("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("useUserStore")]),s._v("()\n    "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 钉钉，浙政钉退到登录失效页面，正常浏览器退出登录")]),s._v("\n    "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("if")]),s._v(" ("),r("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("isDdOrZzd")]),s._v("()) {\n        userStore."),r("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("clearData")]),s._v("() "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 清空存储数据")]),s._v("\n        router."),r("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("replace")]),s._v("({\n            "),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("name")]),s._v(": "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'NoPermission'")]),s._v(", "),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 401页面name,")]),s._v("\n        })\n    } "),r("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("else")]),s._v(" {\n        message."),r("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("error")]),s._v("(data."),r("span",{pre:!0,attrs:{class:"hljs-property"}},[s._v("message")]),s._v(" || "),r("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'无权限或登录失效，请重新登录'")]),s._v(")\n        "),r("span",{pre:!0,attrs:{class:"hljs-built_in"}},[s._v("setTimeout")]),s._v("("),r("span",{pre:!0,attrs:{class:"hljs-function"}},[s._v("() =>")]),s._v(" {\n            userStore."),r("span",{pre:!0,attrs:{class:"hljs-title function_"}},[s._v("logout")]),s._v("()\n        }, "),r("span",{pre:!0,attrs:{class:"hljs-number"}},[s._v("2000")]),s._v(")\n    }\n}\n")])]),r("p",[s._v("401 页面 antd UI 目前用的样式（所有项目尽量统一最好）")]),r("img",{attrs:{src:t(53506)}}),r("h2",[s._v("传递参数的修改")]),r("p",[s._v("新增了一个 org_id，有其余参数也会透传（一般钉钉项目有）")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":""}},[s._v("http://10.123.234.109:11229/#/auth?token=TOKEN&system_code=CODE&org_id=ID&XXX=xxx\n")])]),r("h2",[s._v("接口的修改")]),r("h3",[s._v("1、获取用户信息接口")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":""}},[s._v("/open/user/tokenDetail\n")])]),r("img",{attrs:{src:t(52180)}}),r("h3",[s._v("2、获取动态路由")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":""}},[s._v("/open/permission/router\n")])]),r("img",{attrs:{src:t(54765)}}),r("h3",[s._v("api 地址")]),r("p",[s._v("https://doc-v1.group-ds.com/apidoc/LTAI5tL4mrW1b5ApqbvqFk75/%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83-%E4%B8%9A%E5%8A%A1%E7%AB%AF%E8%B0%83%E7%94%A8%E6%8E%A5%E5%8F%A3%EF%BC%88%E6%96%B0%E7%89%88%EF%BC%89/#api-%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3-apiAuthConfig")]),r("h2",[s._v("env 地址配置")]),r("pre",{pre:!0},[r("code",{pre:!0,attrs:{"v-pre":"",class:"language-js"}},[r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_USER_API_URL")]),s._v(" 为用户中心后台接口地址（用于获取动态路由、用户信息等）\n"),r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_LOGIN_URL")]),s._v(" 为登录失效页面跳转地址\n\n生产地址使用相对路径，除古珀\n\n长兴、柯桥、凉山州、玉环\n"),r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_USER_API_URL")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/bmo-auth-api/")]),s._v("api\n"),r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_LOGIN_URL")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/bmo-auth-pc/")]),s._v("#/login\n\n丽水\n"),r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_USER_API_URL")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/bmo-auth-api-lishui/")]),s._v("api\n"),r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_LOGIN_URL")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/bmo-auth-pc-lishui/")]),s._v("#/login\n\n萧山\n"),r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_USER_API_URL")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/bmo-auth-api-xiaoshan/")]),s._v("api\n"),r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_LOGIN_URL")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/bmo-auth-pc-xiaoshan/")]),s._v("#/login\n\n诸暨\n"),r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_USER_API_URL")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/bmo-auth-api-zhuji/")]),s._v("api\n"),r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_LOGIN_URL")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-regexp"}},[s._v("/bmo-auth-pc-zhuji/")]),s._v("#/login\n\n古珀\n"),r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_USER_API_URL")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("https")]),s._v(":"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//apps.group-ds.com/bmo-auth-api/api")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_LOGIN_URL")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("https")]),s._v(":"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//release.group-ds.com/bmo-auth-pc-xiaoshan/#/login")]),s._v("\n\n测试环境\n"),r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_USER_API_URL")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("https")]),s._v(":"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//uat-api.group-ds.com/bmo-auth-api/api")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"hljs-variable constant_"}},[s._v("VITE_LOGIN_URL")]),s._v("="),r("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("https")]),s._v(":"),r("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//demo.group-ds.com/bmo-auth-pc/#/login")]),s._v("\n")])])])])])}],e=t(1001),p={},_=(0,e.Z)(p,r,n,!1,null,null,null),l=_.exports}}]);