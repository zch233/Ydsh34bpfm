"use strict";(self["webpackChunkvue2_cli5"]=self["webpackChunkvue2_cli5"]||[]).push([[821],{16268:function(n,e,r){n.exports=r.p+"img/img.90403410.png"},62268:function(n,e,r){n.exports=r.p+"img/img_1.ad9bbbed.png"},30082:function(n,e,r){n.exports=r.p+"img/img_10.30eb50a0.png"},6608:function(n,e,r){n.exports=r.p+"img/img_11.ce07b716.png"},90981:function(n,e,r){n.exports=r.p+"img/img_12.e7f57b63.png"},98488:function(n,e,r){n.exports=r.p+"img/img_2.6f80bd51.png"},30434:function(n,e,r){n.exports=r.p+"img/img_3.f40fc258.png"},9606:function(n,e,r){n.exports=r.p+"img/img_4.eeaaaf9d.png"},3590:function(n,e,r){n.exports=r.p+"img/img_6.1512fadd.png"},35358:function(n,e,r){n.exports=r.p+"img/img_7.07d8a24b.png"},72199:function(n,e,r){n.exports=r.p+"img/img_8.7ea381b5.png"},2821:function(n,e,r){r.r(e),r.d(e,{default:function(){return _}});var t=function(){var n=this,e=n.$createElement;n._self._c;return n._m(0)},o=[function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("section",[t("html",[t("head"),t("body",[t("h1",[n._v("前期准备")]),t("h2",[n._v("账号")]),t("ol",[t("li",[t("a",{attrs:{href:"https://exception.group-ds.com/join-request/gupo/"}},[n._v("申请加入公司自建 sentry")]),n._v("(请勿使用 qq 邮箱)")]),t("li",[n._v("进入邮箱中查收邀请链接，并点击创建新账号，之后加入 "),t("img",{attrs:{src:r(72199),alt:""}})]),t("li",[n._v("可能会出现无权限的情况，登录之后重新点击邮箱中的邀请链接即可")]),t("li",[n._v("没有开启二次验证的账号需要开启（这步必须）")]),t("li",[t("img",{attrs:{src:r(90981),alt:""}})]),t("li",[n._v("从邮箱链接确认以后，再次点击上图的 Add 按钮即可进入绑定界面")])]),t("h2",[n._v("依赖")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v("yarn add @sentry/vue @sentry/tracing @sentry/rrweb rrweb\n\n// vue-cli\nyarn add @sentry/webpack-plugin rimraf -D\n// or vite\nyarn add vite-plugin-sentry rimraf -D\n")])]),t("blockquote",[t("p",[n._v("如果依赖安装不上请配置")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v('// .yarnrc\nENTRYCLI_CDNURL "https://cdn.npm.taobao.org/dist/sentry-cli"\nsentrycli_cdnurl "https://cdn.npm.taobao.org/dist/sentry-cli"\n\n// or .npmrc\nENTRYCLI_CDNURL="https://cdn.npm.taobao.org/dist/sentry-cli"\nsentrycli_cdnurl="https://cdn.npm.taobao.org/dist/sentry-cli"\n')])])]),t("h1",[n._v("配置")]),t("h2",[n._v("Vue2")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v("// main.js\nimport * as Sentry from '@sentry/vue';\nimport { BrowserTracing } from '@sentry/tracing';\nimport SentryRRWeb from '@sentry/rrweb';\n\nif (process.env.NODE_ENV !== 'development') {\n  const {VUE_APP_SENTRY_DSN, NODE_ENV, VUE_APP_SENTRY_RELEASE} = process.env\n  Sentry.init({\n    Vue,\n    dsn: VUE_APP_SENTRY_DSN,\n    release: VUE_APP_SENTRY_RELEASE,\n    environment: NODE_ENV,\n    urlPrefix: '~/dist/js',\n    include: './dist',\n    maxValueLength: 4000,\n    attachStacktrace: true,\n    trackComponents: true,\n    ignoreErrors: ['CustomError'],\n    integrations: [\n      new BrowserTracing({\n        routingInstrumentation: Sentry.vueRouterInstrumentation(router),\n      }),\n      new SentryRRWeb(),\n    ],\n    tracesSampleRate: 1.0,\n  });\n}\n")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v("// 如果你的系统有用户信息，还需要记录一下当前用户\nimport * as Sentry from '@sentry/vue';\n\nif (Sentry) {\n  Sentry.setUser({\n    id: 记录你的用户id，方便调式,\n    username: 记录你的用户名称,\n  });\n}\n")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v("// vue.config.js\n  const SentryWebpackPlugin = require('@sentry/webpack-plugin');\n  module.exports = {\n    ...,\n    productionSourceMap: true,\n    configureWebpack: {\n        devtool: 'hidden-source-map',\n    },\n    plugins: [\n        ...,\n        // 注意： 将 Webpack 插件设置为最后运行的插件\n        // 且只有在非测试环境才使用该插件 // 注意：此处代码根据你的逻辑来添加\n        if (process.env.NODE_ENV !== 'development') {\n            const { VUE_APP_SENTRY_URL, VUE_APP_SENTRY_PROJECT, VUE_APP_SENTRY_RELEASE, VUE_APP_SENTRY_AUTH_TOKEN, VUE_APP_SENTRY_ORG } = process.env;\n            new SentryWebpackPlugin({\n              authToken: VUE_APP_SENTRY_AUTH_TOKEN,\n              url: VUE_APP_SENTRY_URL,\n              project: VUE_APP_SENTRY_PROJECT,\n              org: VUE_APP_SENTRY_ORG,\n              release: VUE_APP_SENTRY_RELEASE,\n              // other SentryWebpackPlugin configuration\n              include: './dist',\n              ignore: ['node_modules'],\n              cleanArtifacts: true, // 先清理再上传\n           })\n        }\n    ]\n  }\n")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v("// .env\n\n# sentry\nSENTRY_AUTH_TOKEN=你的账号下的 token，从个人 api 管理下创建\nSENTRY_DSN=管理员创建\nSENTRY_PROJECT=管理员创建\nSENTRY_RELEASE=1.0.0\nSENTRY_URL=https://exception.group-ds.com/\nSENTRY_ORG=gupo\n\nVUE_APP_SENTRY_AUTH_TOKEN=$SENTRY_AUTH_TOKEN\nVUE_APP_SENTRY_RELEASE=${SENTRY_PROJECT}@${SENTRY_RELEASE}\nVUE_APP_SENTRY_DSN=$SENTRY_DSN\nVUE_APP_SENTRY_URL=$SENTRY_URL\nVUE_APP_SENTRY_ORG=$SENTRY_ORG\nVUE_APP_SENTRY_PROJECT=$SENTRY_PROJECT\n")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v("// .env.xxx // 根据你的其他环境来设置\n\nSENTRY_RELEASE=production-1.0.0 // 例如 .env.production\n")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v('// package.json\n// maybe u need install rimraf\nscripts: {\n   ...,\n   "postbuild": "rimraf ./dist/js/*.js.map", // 这里一一对应你上面的打包命令，和你的项目构建的文件夹名称\n   "postbuild:stage": "rimraf ./dist/js/*.js.map", // 这里一一对应你上面的打包命令，和你的项目构建的文件夹名称\n   "postbuild:prod": "rimraf ./dist/js/*.js.map", // 这里一一对应你上面的打包命令，和你的项目构建的文件夹名称\n}\n')])]),t("h2",[n._v("Vue3")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v("// main.js\nimport * as Sentry from '@sentry/vue';\nimport { BrowserTracing } from '@sentry/tracing';\nimport SentryRRWeb from '@sentry/rrweb';\n\nif (process.env.NODE_ENV !== 'development') {\n    const { VITE_SENTRY_DSN, VITE_SENTRY_RELEASE } = import.meta.env\n    Sentry.init({\n        app,\n        dsn: VITE_SENTRY_DSN,\n        environment: process.env.NODE_ENV,\n        integrations: [\n            new BrowserTracing({\n                routingInstrumentation: Sentry.vueRouterInstrumentation(router),\n            }),\n            new SentryRRWeb(),\n        ],\n        ignoreErrors: ['CustomError'],\n        maxValueLength: 4000,\n        trackComponents: true,\n        tracesSampleRate: 1.0,\n        release: VITE_SENTRY_RELEASE,\n    });\n    Sentry.attachErrorHandler(app, { attachProps: true, logErrors: true, trackComponents: true, timeout: 2000, hooks: ['activate', 'mount', 'update'] });\n}\n")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v("// 如果你的系统有用户信息，还需要记录一下当前用户\nimport * as Sentry from '@sentry/vue';\n\nif (Sentry) {\n  Sentry.setUser({\n    id: 记录你的用户id，方便调式,\n    username: 记录你的用户名称,\n  });\n}\n")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v("// vite.config.js\nimport viteSentry from 'vite-plugin-sentry';\n\nbuild: {\n    ...,\n    sourcemap: 'hidden',\n},\nplugins: [\n    // 且只有在非测试环境才使用该插件 // 注意：此处代码根据你的逻辑来添加\n    if (config.mode !== 'development') {\n        const { VITE_SENTRY_PROJECT, VITE_SENTRY_AUTH_TOKEN, VITE_SENTRY_URL, VITE_SENTRY_ORG, VITE_SENTRY_RELEASE } = viteEnv;\n        plugins.push(viteSentry({\n            authToken: VITE_SENTRY_AUTH_TOKEN,\n            url: VITE_SENTRY_URL,\n            org: VITE_SENTRY_ORG,\n            project: VITE_SENTRY_PROJECT,\n            release: VITE_SENTRY_RELEASE,\n            skipEnvironmentCheck: true, // 可以跳过环境检查\n            sourceMaps: {\n                include: ['./dist/assets'],\n                ignore: ['node_modules'],\n                urlPrefix: '~/assets',\n            },\n            cleanArtifacts: true, // 先清理再上传\n        }))\n    }\n]\n")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v("// .env\n\n# sentry\nSENTRY_AUTH_TOKEN=你的账号下的 token，从个人 api 管理下创建\nSENTRY_DSN=管理员创建\nSENTRY_PROJECT=管理员创建\nSENTRY_RELEASE=1.0.0\nSENTRY_URL=https://exception.group-ds.com/\nSENTRY_ORG=gupo\n\nVITE_SENTRY_AUTH_TOKEN=$SENTRY_AUTH_TOKEN\nVITE_SENTRY_RELEASE=${SENTRY_PROJECT}@${SENTRY_RELEASE}\nVITE_SENTRY_DSN=$SENTRY_DSN\nVITE_SENTRY_URL=$SENTRY_URL\nVITE_SENTRY_ORG=$SENTRY_ORG\nVITE_SENTRY_PROJECT=$SENTRY_PROJECT\n")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v("// .env.xxx // 根据你的其他环境来设置\n\n// 例如 .env.production\nSENTRY_RELEASE=production-1.0.0\n")])]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v('// package.json\n// maybe u need install rimraf\nscripts: {\n   ...,\n   "postbuild": "rimraf ./dist/assets/*.js.map", // 这里一一对应你上面的打包命令，和你的项目构建的文件夹名称\n   "postbuild:stage": "rimraf ./dist/assets/*.js.map", // 这里一一对应你上面的打包命令，和你的项目构建的文件夹名称\n   "postbuild:prod": "rimraf ./dist/assets/*.js.map", // 这里一一对应你上面的打包命令，和你的项目构建的文件夹名称\n}\n')])]),t("h1",[n._v("最佳实践")]),t("h2",[n._v("错误抛出方式")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v("# BAD\nthrow '这是一个错误'\n\n#GOOD\nthrow new Error('这是一个错误')\n")])]),t("h3",[n._v("自定义错误不上报 sentry")]),t("pre",{pre:!0},[t("code",{pre:!0,attrs:{"v-pre":""}},[n._v("export class CustomError extends Error {\n  constructor(...params) {\n    super(...params);\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, CustomError);\n    }\n    this.name = 'CustomError';\n    // Custom debugging information\n    this.date = new Date();\n  }\n}\n\nthrow new CustomError ('这是一个错误')\n")])]),t("h2",[n._v("钉钉接入")]),t("h4",[n._v("创建机器人")]),t("p",[n._v("新建群聊，可以将后端和想换开发人员加入，并在群设置中打开自定义机器人")]),t("p",[t("img",{attrs:{src:r(30434),alt:""}})]),t("p",[t("img",{attrs:{src:r(16268),alt:""}})]),t("p",[t("img",{attrs:{src:r(62268),alt:""}})]),t("h4",[n._v("sentry 接入")]),t("p",[n._v("打开对应项目的设置，并进入 WebHooks")]),t("p",[t("img",{attrs:{src:r(3590),alt:""}})]),t("p",[t("img",{attrs:{src:r(35358),alt:""}})]),t("p",[t("img",{attrs:{src:r(98488),alt:""}})]),t("blockquote",[t("p",[n._v("http://172.20.10.150:8000/webhook/dingtalk-from-sentry-aimfulbbmldb?url=请填写上图的Webhook链接")]),t("p",[t("code",{pre:!0},[n._v("url=请填写上图的Webhook链接")]),n._v("，注意：Webhook 链接 需要 "),t("a",{attrs:{href:"http://www.jsons.cn/urlencode"}},[n._v("encode")]),n._v(" 一下")])]),t("p",[n._v("设置提醒规则")]),t("p",[t("img",{attrs:{src:r(9606),alt:""}})]),t("p",[t("img",{attrs:{src:r(30082),alt:""}})]),t("p",[t("img",{attrs:{src:r(6608),alt:""}})]),t("h2",[n._v("Q&A")]),t("blockquote",[t("p",[n._v("Q: JavaScript heap out of memory")]),t("p",[n._v("A: 在 vue/vite.config 中关闭配置 sourceMap")])]),t("blockquote",[t("p",[n._v("Q: 接入以后在旧版浏览器打不开")]),t("p",[n._v("A: 在 vue.config 中配置 transpileDependencies: ['@sentry']，vite 中配置环境变量 VITE_LEGACY=true")])]),t("blockquote",[t("p",[n._v("Q: Uncaught TypeError: Cannot read properties of undefined (reading 'XXXXX') "),t("img",{attrs:{src:"img_9.png",alt:"./img_9.png"}})]),t("p",[n._v("A: 检查你的项目配置或者暂时删除 rrweb 后续：")])]),t("ul",[t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzA4Mzc4NTE5MQ==&mid=2692294746&idx=1&sn=7e90fe832d8370bf2d3cb40c972ceda6&scene=21#wechat_redirect"}},[n._v("配置参考")])])])])])])}],s=r(1001),p={},i=(0,s.Z)(p,t,o,!1,null,null,null),_=i.exports}}]);